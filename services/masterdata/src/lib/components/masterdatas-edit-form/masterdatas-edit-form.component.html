<lens-panel
	header="{{ formTitle }} Masterdata to type '{{
		(masterdataType$ | async)?.name
	}}'">
	<div class="form-wrapper">
		<div class="form-header">
			<div
				class="mb-4"
				style="color: var(--primary-color)">
				<lens-icon
					icon="pi-arrow-left"
					class="mr-2">
        </lens-icon>
				<a routerLink="..">Back to list</a>
			</div>
		</div>
		<div class="form-body">
			<form [formGroup]="dataForm">
				<div class="p-fluid mb-4">
					<!-- only for edit form -->
					<ng-container *ngIf="!isAddForm && item">
						<ng-container
							*ngTemplateOutlet="
								editFormBlock;
								context: { item: item }
							">
            </ng-container>
					</ng-container>
					<!-- end only for edit form -->
					<!-- only for add form -->
					<ng-container *ngIf="isAddForm">
						<ng-container *ngTemplateOutlet="addFormBlock"></ng-container>
					</ng-container>
					<!-- end only for add form -->
					<ng-container *ngTemplateOutlet="sharedFormBlock"></ng-container>

					<ng-template
						#editFormBlock
						let-item="item">
						<div class="field view-only">
							<label>Key</label>
							<span>{{ item.key }}</span>
						</div>
					</ng-template>

					<ng-template #addFormBlock>
						<ng-container *ngIf="needsTypeIdSelector">
							<ng-container
								*ngTemplateOutlet="showTypeIdSelectorBlock">
              </ng-container>
						</ng-container>
						<ng-container *ngTemplateOutlet="showKeyBlock"></ng-container>

						<ng-template #showTypeIdSelectorBlock>
							<!-- type id -->
							<div class="field">
								<label for="masterdataTypeId">Masterdata Type</label>
								<lens-services-masterdata-type-selector
									id="masterdataTypeId"
									formControlName="masterdataTypeId"
									[masterdataTypes]="typesList">
                </lens-services-masterdata-type-selector>
								<div
									*ngIf="
										isFormSubmitted &&
										getFormFields['masterdataTypeId']!.invalid
									"
									class="p-error">
									<div
										*ngIf="getFormFields['masterdataTypeId']!.errors?.['required']">
										Masterdata Type is required.
									</div>
								</div>
							</div>
						</ng-template>
						<ng-template #showKeyBlock>
							<!-- key -->
							<div class="field">
								<label for="key">Key</label>
								<lens-input-text
									id="key"
									formControlName="key"
									placeholder="Please enter a valid key">
                </lens-input-text>
								<div
									*ngIf="isFormSubmitted && getFormFields['key']!.invalid"
									class="p-error">
									<div *ngIf="getFormFields['key']!.errors?.['required']">
										Key is required.
									</div>
									<div *ngIf="getFormFields['key']!.errors?.['maxlength']">
										Key can be max {{ maxLength.key }} characters long.
									</div>
								</div>
							</div>
						</ng-template>
					</ng-template>

					<ng-template #sharedFormBlock>
						<!-- value -->
						<div class="field">
							<label for="value">Value</label>
							<lens-input-text
								id="value"
								formControlName="value"
								placeholder="Please enter a valid value">
              </lens-input-text>
							<div
								*ngIf="isFormSubmitted && getFormFields['value']!.invalid"
								class="p-error">
								<div *ngIf="getFormFields['value']!.errors?.['required']">
									Value is required.
								</div>
								<div *ngIf="getFormFields['value']!.errors?.['maxlength']">
									Value can be max {{ maxLength.value }} characters long.
								</div>
							</div>
						</div>
						<!-- name -->
						<div class="field">
							<label for="name">Name</label>
							<lens-input-text
								id="name"
								formControlName="name"
								placeholder="Please enter a valid name">
              </lens-input-text>
							<div
								*ngIf="isFormSubmitted && getFormFields['name']!.invalid"
								class="p-error">
								<div *ngIf="getFormFields['name']!.errors?.['required']">
									Name is required.
								</div>
								<div *ngIf="getFormFields['name']!.errors?.['maxlength']">
									Name can be max {{ maxLength.name }} characters long.
								</div>
							</div>
						</div>
						<!-- description -->
						<div class="field">
							<label for="description">Description</label>
							<lens-input-textarea
								id="description"
								formControlName="description"
								placeholder="Please enter a valid description">
              </lens-input-textarea>
							<div
								*ngIf="isFormSubmitted && getFormFields['description']!.invalid"
								class="p-error">
								<div *ngIf="getFormFields['description']!.errors?.['required']">
									Description is required.
								</div>
								<div
									*ngIf="getFormFields['description']!.errors?.['maxlength']">
									Description can be max {{ maxLength.description }} characters
									long.
								</div>
							</div>
						</div>
            <!-- tags -->
            <div class="field">
              <label for="tags">Tags</label>
              <lens-services-tags-selector
                id="tags"
                formControlName="tags"
                [tags]="tagsList">
              </lens-services-tags-selector>
              <div
                *ngIf="
                  isFormSubmitted &&
                  getFormFields['tags']!.invalid
                "
                class="p-error">
                <div
                  *ngIf="getFormFields['tags']!.errors?.['required']">
                  Tags is required.
                </div>
              </div>
            </div>
						<!-- metadata -->
						<div class="field">
							<label for="metadata">Metadata</label>
              <json-editor
                [options]="makeMetadataEditorOptions()"
                formControlName="metadata"
              >
              </json-editor>
              <div class="help-text">* if you want to remove a (key, value) pair, set value to null</div>
							<div
								*ngIf="isFormSubmitted && getFormFields['metadata']!.invalid"
								class="p-error">
								<div *ngIf="getFormFields['metadata']!.errors?.['required']">
									Metadata is required.
								</div>
								<div
									*ngIf="getFormFields['metadata']!.errors?.['maxlength']">
									Metadata can be max {{ maxLength.metadata }} characters
									long.
								</div>
							</div>
						</div>
					</ng-template>
				</div>
			</form>

			<div class="form-actions">
				<div>
					<lens-button
						label="{{ saveBtnText }}"
						icon="pi pi-save"
						type="success"
						[disabled]="isLoading"
						(clicked)="onSubmit()">
          </lens-button>
				</div>
				<div>
					<lens-button
						label="Cancel"
						icon="pi pi-backward"
						(clicked)="btnCancel()">
          </lens-button>
				</div>
			</div>
		</div>
	</div>
</lens-panel>
